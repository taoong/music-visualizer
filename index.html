<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Music Visualizer</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
</head>
<body>
  <!-- Splash overlay — requires user gesture to start AudioContext -->
  <div id="splash">
    <div id="splash-content">
      <h1>Music Visualizer</h1>
      <p>Upload a track or use the sample, then press Play.</p>
      <div id="splash-buttons">
        <label id="upload-label" for="audio-upload">Upload Track</label>
        <input type="file" id="audio-upload" accept="audio/*" />
        <button id="use-sample-btn">Use Sample Track</button>
      </div>
      <span id="file-name"></span>
      <div id="mode-selector">
        <button id="mode-freq" class="mode-btn active">Frequency Bands</button>
        <button id="mode-stems" class="mode-btn">Stem Separation <span class="badge">Experimental</span></button>
      </div>
      <button id="play-btn" disabled>Play</button>
    </div>
  </div>

  <!-- Processing overlay -->
  <div id="processing" class="hidden">
    <div id="processing-content">
      <div class="spinner"></div>
      <p id="processing-text">Separating stems…</p>
    </div>
  </div>

  <!-- Sidebar GUI -->
  <aside id="sidebar">
    <h2>Controls</h2>

    <section>
      <h3>Sensitivity</h3>
      <!-- Frequency mode sliders (shown by default) -->
      <div id="freq-sliders">
        <div class="slider-group">
          <label>Bass (Drums)</label>
          <input type="range" id="sens-bass" min="0" max="3" step="0.01" value="2.0" />
        </div>
        <div class="slider-group">
          <label>Vocals (Melody)</label>
          <input type="range" id="sens-mid" min="0" max="3" step="0.01" value="2.0" />
        </div>
        <div class="slider-group">
          <label>Treble (Percussion)</label>
          <input type="range" id="sens-treble" min="0" max="3" step="0.01" value="2.0" />
        </div>
      </div>
      <!-- Stem mode sliders (hidden by default) -->
      <div id="stem-sliders" class="hidden">
        <div class="slider-group">
          <label>Kick</label>
          <input type="range" id="sens-kick" min="0" max="3" step="0.01" value="2.0" />
        </div>
        <div class="slider-group">
          <label>Drums</label>
          <input type="range" id="sens-drums" min="0" max="3" step="0.01" value="2.0" />
        </div>
        <div class="slider-group">
          <label>Bass</label>
          <input type="range" id="sens-bass-stem" min="0" max="3" step="0.01" value="2.0" />
        </div>
        <div class="slider-group">
          <label>Vocals</label>
          <input type="range" id="sens-vocals" min="0" max="3" step="0.01" value="2.0" />
        </div>
        <div class="slider-group">
          <label>Other</label>
          <input type="range" id="sens-other" min="0" max="3" step="0.01" value="2.0" />
        </div>
      </div>
    </section>

    <section>
      <h3>Display</h3>
      <div class="slider-group">
        <label>Spike Scale</label>
        <input type="range" id="spike-scale" min="0" max="2" step="0.01" value="1.2" />
      </div>
      <div class="slider-group">
        <label>Rotation Speed</label>
        <input type="range" id="rotation-speed" min="0" max="2" step="0.01" value="0.3" />
      </div>
    </section>

    <section>
      <button id="randomize-btn">Randomize</button>
    </section>
  </aside>

  <!-- Toggle sidebar button -->
  <button id="sidebar-toggle">&#9776;</button>

  <!-- p5.js canvas goes here -->
  <main id="canvas-container"></main>

  <footer id="playback-bar">
    <div id="scrubber-row">
      <span id="time-display">0:00 / 0:00</span>
      <div id="scrubber-group">
        <input type="range" id="scrubber" min="0" max="100" step="0.1" value="0" />
      </div>
    </div>
    <div id="controls-row">
      <button id="pause-btn" class="is-playing"></button>
      <div id="track-info">
        <span id="track-name"></span>
        <label id="change-track-label" for="sidebar-audio-upload" title="Change Track">&#128193;</label>
        <input type="file" id="sidebar-audio-upload" accept="audio/*" />
      </div>
      <div id="volume-group">
        <button id="volume-btn" type="button">&#128266;</button>
        <div id="volume-popup">
          <input type="range" id="master-volume" min="0" max="1" step="0.01" value="0.8" orient="vertical" />
        </div>
      </div>
    </div>
  </footer>

  <script src="sketch.js"></script>
</body>
</html>
